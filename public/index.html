<!doctype html>
<html lang="en" ng-app="gmpApp">
<head>
	<meta charset="UTF-8">
	<title ng-bind="title"></title>
	<link rel="stylesheet" href="/css/bundle.css">
</head>
<body>


<div class="wrap" ng-view></div>

<script src="lib/angular/angular.min.js"></script>
<script src="lib/angular/angular-route.min.js"></script>
<script src="lib/angular/angular-sanitize.min.js"></script>
<script src="js/app.js"></script>
<script src="js/services.js"></script>
<script src="js/controllers.js"></script>

<script src="lib/jquery-1.11.1.min.js"></script>
<!-- ace editor -->
<script src="lib/ace/ace.js"></script>
<script src="lib/ace/mode-markdown.js"></script>
<script src="lib/ace/theme-github.js"></script>
<script src="lib/ace/ext-language_tools.js"></script>
<script src="lib/ace/snippets/markdown.js"></script>
<script>
	window.onload = function(){
		var editor = ace.edit('editor');
		var session = editor.session;
		// editor set
		editor.setTheme('ace/theme/github');
		editor.setShowInvisibles(true);

		// editor session set
		session.setMode('ace/mode/markdown');
		session.setFoldStyle('markbegin');

		// 强制换行
		session.setUseWrapMode(true);
		session.setWrapLimitRange(80, 80);
		editor.renderer.setPrintMarginColumn(80);

		// render set
		editor.renderer.setHScrollBarAlwaysVisible(false);
		

	    ace.config.loadModule("ace/ext/language_tools", function() {
	        editor.setOptions({
	            enableSnippets: true,
	            enableBasicAutocompletion: true
	        });
	    });

	    var postValue;
	    var taMiddle = $('#taMiddle');
	    var postPreview = $('#postPreview');
	    editor.on('change', function(){
	    	postValue = editor.getValue();
	    	// taMiddle.text(postValue).trigger('change');
	    	$.ajax({
	    		type: 'post',
	    		url: '/preview',
	    		data: { "content": postValue },
	    		success: function(data){
	    			postPreview.html(data.content);
	    		}
	    	})
	    });

	    taMiddle.on('change', function(){
	    	console.log('change');
	    })
	}
</script>
</body>
</html>